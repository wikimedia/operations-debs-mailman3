From: Jonas Meurer <jonas@freesources.org>
Date: Fri, 22 Feb 2019 23:44:12 +0100
Subject: Replace importlib_resources with importlib.resources

`importlib_resources` is not available in Debian. Since Debian Buster
ships only Python3.7 anyway, we can safely migrate to
`importlib.resources`.

Forwarded: not-needed
Author: Jonas Meurer <jonas@freesources.org>
---
 setup.py                                       | 1 -
 src/mailman.egg-info/requires.txt              | 1 -
 src/mailman/archiving/tests/test_mhonarc.py    | 2 +-
 src/mailman/bin/tests/test_mailman.py          | 2 +-
 src/mailman/bin/tests/test_master.py           | 2 +-
 src/mailman/chains/tests/test_hold.py          | 2 +-
 src/mailman/commands/docs/import.rst           | 2 +-
 src/mailman/commands/tests/test_cli_control.py | 2 +-
 src/mailman/commands/tests/test_cli_import.py  | 2 +-
 src/mailman/config/config.py                   | 4 ++--
 src/mailman/config/tests/test_configuration.py | 2 +-
 src/mailman/core/initialize.py                 | 2 +-
 src/mailman/email/tests/test_message.py        | 2 +-
 src/mailman/handlers/tests/test_mimedel.py     | 2 +-
 src/mailman/plugins/docs/intro.rst             | 2 +-
 src/mailman/plugins/testing/layer.py           | 2 +-
 src/mailman/rules/dmarc.py                     | 2 +-
 src/mailman/rules/tests/test_dmarc.py          | 2 +-
 src/mailman/testing/i18n.py                    | 2 +-
 src/mailman/testing/layers.py                  | 2 +-
 src/mailman/utilities/modules.py               | 3 ++-
 src/mailman/utilities/tests/test_import.py     | 2 +-
 22 files changed, 22 insertions(+), 23 deletions(-)

diff --git a/setup.py b/setup.py
index a061598..5cf6fdc 100644
--- a/setup.py
+++ b/setup.py
@@ -115,7 +115,6 @@ case second 'm'.  Any other spelling is incorrect.""",
         'flufl.bounce',
         'flufl.i18n>=2.0',
         'flufl.lock>=3.1',
-        'importlib_resources>=1.1.0',
         'gunicorn',
         'lazr.config',
         'python-dateutil>=2.0',
diff --git a/src/mailman.egg-info/requires.txt b/src/mailman.egg-info/requires.txt
index 54ac2bd..61ec47c 100644
--- a/src/mailman.egg-info/requires.txt
+++ b/src/mailman.egg-info/requires.txt
@@ -9,7 +9,6 @@ falcon>1.0.0
 flufl.bounce
 flufl.i18n>=2.0
 flufl.lock>=3.1
-importlib_resources>=1.1.0
 gunicorn
 lazr.config
 python-dateutil>=2.0
diff --git a/src/mailman/archiving/tests/test_mhonarc.py b/src/mailman/archiving/tests/test_mhonarc.py
index 7a5e16a..e432016 100644
--- a/src/mailman/archiving/tests/test_mhonarc.py
+++ b/src/mailman/archiving/tests/test_mhonarc.py
@@ -23,10 +23,10 @@ import shutil
 import tempfile
 import unittest
 
-from importlib_resources import path
 from mailman.app.lifecycle import create_list
 from mailman.archiving.mhonarc import MHonArc
 from mailman.database.transaction import transaction
+from mailman.utilities.filesystem import path
 from mailman.testing.helpers import (
     configuration, specialized_message_from_string as mfs)
 from mailman.testing.layers import ConfigLayer
diff --git a/src/mailman/bin/tests/test_mailman.py b/src/mailman/bin/tests/test_mailman.py
index 4f6900d..5e03011 100644
--- a/src/mailman/bin/tests/test_mailman.py
+++ b/src/mailman/bin/tests/test_mailman.py
@@ -21,7 +21,6 @@ import unittest
 
 from click.testing import CliRunner
 from datetime import timedelta
-from importlib_resources import path
 from mailman.app.lifecycle import create_list
 from mailman.bin.mailman import main
 from mailman.config import config
@@ -29,6 +28,7 @@ from mailman.database.transaction import transaction
 from mailman.interfaces.command import ICLISubCommand
 from mailman.testing.layers import ConfigLayer
 from mailman.utilities.datetime import now
+from mailman.utilities.filesystem import path
 from mailman.utilities.modules import add_components
 from unittest.mock import patch
 
diff --git a/src/mailman/bin/tests/test_master.py b/src/mailman/bin/tests/test_master.py
index f176bf1..51edc48 100644
--- a/src/mailman/bin/tests/test_master.py
+++ b/src/mailman/bin/tests/test_master.py
@@ -25,11 +25,11 @@ from click.testing import CliRunner
 from contextlib import ExitStack, suppress
 from datetime import timedelta
 from flufl.lock import Lock, TimeOutError
-from importlib_resources import path
 from io import StringIO
 from mailman.bin import master
 from mailman.config import config
 from mailman.testing.layers import ConfigLayer
+from mailman.utilities.filesystem import path
 from unittest.mock import patch
 
 
diff --git a/src/mailman/chains/tests/test_hold.py b/src/mailman/chains/tests/test_hold.py
index f93bc2f..087b0b5 100644
--- a/src/mailman/chains/tests/test_hold.py
+++ b/src/mailman/chains/tests/test_hold.py
@@ -20,7 +20,7 @@
 import unittest
 
 from email import message_from_bytes as mfb
-from importlib_resources import read_binary
+from importlib.resources import read_binary
 from mailman.app.lifecycle import create_list
 from mailman.chains.builtin import BuiltInChain
 from mailman.chains.hold import HoldChain, autorespond_to_sender
diff --git a/src/mailman/commands/docs/import.rst b/src/mailman/commands/docs/import.rst
index 67e0f8b..cc3a523 100644
--- a/src/mailman/commands/docs/import.rst
+++ b/src/mailman/commands/docs/import.rst
@@ -25,7 +25,7 @@ You must also specify a pickle file to import.
 
 Too bad the list doesn't exist.
 
-    >>> from importlib_resources import path
+    >>> from mailman.utilities.filesystem import path
     >>> with path('mailman.testing', 'config.pck') as pickle_path:
     ...     pickle_file = str(pickle_path)
     ...     command('mailman import21 import@example.com ' + pickle_file)
diff --git a/src/mailman/commands/tests/test_cli_control.py b/src/mailman/commands/tests/test_cli_control.py
index 6222fb8..374ac2f 100644
--- a/src/mailman/commands/tests/test_cli_control.py
+++ b/src/mailman/commands/tests/test_cli_control.py
@@ -29,12 +29,12 @@ from click.testing import CliRunner
 from contextlib import ExitStack, suppress
 from datetime import datetime, timedelta
 from flufl.lock import SEP
-from importlib_resources import path
 from mailman.bin.master import WatcherState
 from mailman.commands.cli_control import reopen, restart, start
 from mailman.config import config
 from mailman.testing.helpers import configuration
 from mailman.testing.layers import ConfigLayer
+from mailman.utilities.filesystem import path
 from public import public
 from tempfile import TemporaryDirectory
 from unittest.mock import patch
diff --git a/src/mailman/commands/tests/test_cli_import.py b/src/mailman/commands/tests/test_cli_import.py
index 6a3dd0a..5dfea6e 100644
--- a/src/mailman/commands/tests/test_cli_import.py
+++ b/src/mailman/commands/tests/test_cli_import.py
@@ -21,10 +21,10 @@ import unittest
 
 from click.testing import CliRunner
 from contextlib import ExitStack
-from importlib_resources import path
 from mailman.app.lifecycle import create_list
 from mailman.commands.cli_import import import21
 from mailman.testing.layers import ConfigLayer
+from mailman.utilities.filesystem import path
 from mailman.utilities.importer import Import21Error
 from pickle import dump
 from tempfile import NamedTemporaryFile
diff --git a/src/mailman/config/config.py b/src/mailman/config/config.py
index 104e926..3c024f5 100644
--- a/src/mailman/config/config.py
+++ b/src/mailman/config/config.py
@@ -24,13 +24,13 @@ import mailman.templates
 from configparser import ConfigParser
 from contextlib import ExitStack
 from flufl.lock import Lock
-from importlib_resources import path, read_text
+from importlib.resourcess import read_text
 from lazr.config import ConfigSchema, as_boolean
 from mailman import version
 from mailman.interfaces.configuration import (
     ConfigurationUpdatedEvent, IConfiguration, MissingConfigurationFileError)
 from mailman.interfaces.languages import ILanguageManager
-from mailman.utilities.filesystem import makedirs
+from mailman.utilities.filesystem import makedirs, path
 from mailman.utilities.modules import call_name, expand_path
 from public import public
 from string import Template
diff --git a/src/mailman/config/tests/test_configuration.py b/src/mailman/config/tests/test_configuration.py
index 74c1838..583fca3 100644
--- a/src/mailman/config/tests/test_configuration.py
+++ b/src/mailman/config/tests/test_configuration.py
@@ -22,13 +22,13 @@ import tempfile
 import unittest
 
 from contextlib import ExitStack
-from importlib_resources import path
 from mailman.config.config import (
     Configuration, external_configuration, load_external)
 from mailman.interfaces.configuration import (
     ConfigurationUpdatedEvent, MissingConfigurationFileError)
 from mailman.testing.helpers import configuration, event_subscribers
 from mailman.testing.layers import ConfigLayer
+from mailman.utilities.filesystem import path
 from tempfile import NamedTemporaryFile, TemporaryDirectory
 from unittest import mock
 
diff --git a/src/mailman/core/initialize.py b/src/mailman/core/initialize.py
index d23685b..3f5a966 100644
--- a/src/mailman/core/initialize.py
+++ b/src/mailman/core/initialize.py
@@ -30,7 +30,7 @@ import logging
 import mailman.config.config
 import mailman.core.logging
 
-from importlib_resources import read_text
+from importlib.resources import read_text
 from mailman.interfaces.database import IDatabaseFactory
 from public import public
 from zope.component import getUtility
diff --git a/src/mailman/email/tests/test_message.py b/src/mailman/email/tests/test_message.py
index cf097e0..0859270 100644
--- a/src/mailman/email/tests/test_message.py
+++ b/src/mailman/email/tests/test_message.py
@@ -22,11 +22,11 @@ import unittest
 from email import message_from_binary_file
 from email.header import Header
 from email.parser import FeedParser
-from importlib_resources import path
 from mailman.app.lifecycle import create_list
 from mailman.email.message import Message, UserNotification
 from mailman.testing.helpers import get_queue_messages
 from mailman.testing.layers import ConfigLayer
+from mailman.utilities.filesystem import path
 
 
 class TestMessage(unittest.TestCase):
diff --git a/src/mailman/handlers/tests/test_mimedel.py b/src/mailman/handlers/tests/test_mimedel.py
index 25c8994..560e626 100644
--- a/src/mailman/handlers/tests/test_mimedel.py
+++ b/src/mailman/handlers/tests/test_mimedel.py
@@ -25,7 +25,7 @@ import tempfile
 import unittest
 
 from contextlib import ExitStack, contextmanager
-from importlib_resources import open_binary as resource_open, read_text
+from importlib.resources import open_binary as resource_open, read_text
 from io import StringIO
 from mailman.app.lifecycle import create_list
 from mailman.config import config
diff --git a/src/mailman/plugins/docs/intro.rst b/src/mailman/plugins/docs/intro.rst
index 9831f70..a77adf1 100644
--- a/src/mailman/plugins/docs/intro.rst
+++ b/src/mailman/plugins/docs/intro.rst
@@ -16,7 +16,7 @@ enabled by adding a section to your ``mailman.cfg`` file, such as:
 
 We have such a configuration file handy.
 
-    >>> from importlib_resources import path
+    >>> from mailman.utilities.filesystem import path
     >>> config_file = str(cleanups.enter_context(
     ...     path('mailman.plugins.testing', 'hooks.cfg')))
 
diff --git a/src/mailman/plugins/testing/layer.py b/src/mailman/plugins/testing/layer.py
index 230be56..597fe45 100644
--- a/src/mailman/plugins/testing/layer.py
+++ b/src/mailman/plugins/testing/layer.py
@@ -20,10 +20,10 @@
 import os
 
 from contextlib import ExitStack
-from importlib_resources import path
 from mailman.testing.helpers import (
     TestableMaster, hackenv, wait_for_webservice)
 from mailman.testing.layers import SMTPLayer
+from mailman.utilities.filesystem import path
 from public import public
 
 
diff --git a/src/mailman/rules/dmarc.py b/src/mailman/rules/dmarc.py
index e9235bd..c3d26f8 100644
--- a/src/mailman/rules/dmarc.py
+++ b/src/mailman/rules/dmarc.py
@@ -24,7 +24,7 @@ import dns.resolver
 
 from dns.exception import DNSException
 from email.utils import parseaddr
-from importlib_resources import read_binary
+from importlib.resources import read_binary
 from lazr.config import as_timedelta
 from mailman.config import config
 from mailman.core.i18n import _
diff --git a/src/mailman/rules/tests/test_dmarc.py b/src/mailman/rules/tests/test_dmarc.py
index 68ba04b..0011988 100644
--- a/src/mailman/rules/tests/test_dmarc.py
+++ b/src/mailman/rules/tests/test_dmarc.py
@@ -27,7 +27,6 @@ from dns.rdatatype import CNAME, TXT
 from dns.resolver import NXDOMAIN, NoAnswer, NoNameservers
 from email import message_from_bytes
 from http.server import BaseHTTPRequestHandler, HTTPServer
-from importlib_resources import path
 from lazr.config import as_timedelta
 from mailman.app.lifecycle import create_list
 from mailman.config import config
@@ -38,6 +37,7 @@ from mailman.testing.helpers import (
     wait_for_webservice)
 from mailman.testing.layers import ConfigLayer
 from mailman.utilities.datetime import now
+from mailman.utilities.filesystem import path
 from public import public
 from unittest import TestCase
 from unittest.mock import patch
diff --git a/src/mailman/testing/i18n.py b/src/mailman/testing/i18n.py
index cab6365..2162c16 100644
--- a/src/mailman/testing/i18n.py
+++ b/src/mailman/testing/i18n.py
@@ -19,7 +19,7 @@
 
 from flufl.i18n import registry
 from gettext import GNUTranslations, NullTranslations
-from importlib_resources import open_binary
+from importlib.resources import open_binary
 from public import public
 
 
diff --git a/src/mailman/testing/layers.py b/src/mailman/testing/layers.py
index fff1dd9..2d2c169 100644
--- a/src/mailman/testing/layers.py
+++ b/src/mailman/testing/layers.py
@@ -32,7 +32,7 @@ import logging
 import datetime
 import tempfile
 
-from importlib_resources import read_text
+from importlib.resources import read_text
 from lazr.config import as_boolean
 from mailman.config import config
 from mailman.core import initialize
diff --git a/src/mailman/utilities/modules.py b/src/mailman/utilities/modules.py
index 6c572ca..13f0ae5 100644
--- a/src/mailman/utilities/modules.py
+++ b/src/mailman/utilities/modules.py
@@ -22,7 +22,8 @@ import sys
 
 from contextlib import contextmanager
 from importlib import import_module
-from importlib_resources import contents, is_resource, path
+from importlib.resources import contents, is_resource
+from mailman.utilities.filesystem import path
 from public import public
 
 
diff --git a/src/mailman/utilities/tests/test_import.py b/src/mailman/utilities/tests/test_import.py
index 950f7ba..202f279 100644
--- a/src/mailman/utilities/tests/test_import.py
+++ b/src/mailman/utilities/tests/test_import.py
@@ -22,7 +22,7 @@ import unittest
 
 from datetime import timedelta, datetime
 from enum import Enum
-from importlib_resources import open_binary
+from importlib.resources import open_binary
 from mailman.app.lifecycle import create_list
 from mailman.config import config
 from mailman.handlers.decorate import decorate
