#!/bin/sh

set -e

. /usr/share/debconf/confmodule

db_input medium mailman3-core/choose_db || true
db_go
db_get mailman3-core/choose_db
MM3_DB="${RET}"

if [ "${MM3_DB}" = "postgresql" ]; then
    if [ -f /usr/share/dbconfig-common/dpkg/config.pgsql ]; then
        dbc_dbname="mailman3core"
        dbc_dbuser="mailman3core"
        . /usr/share/dbconfig-common/dpkg/config.pgsql
        dbc_go mailman3-core "$@"
    fi
elif [ "${MM3_DB}" = "mysql" ]; then
    if [ -f /usr/share/dbconfig-common/dpkg/config.mysql ]; then
        dbc_dbname="mailman3core"
        dbc_dbuser="mailman3core"
        . /usr/share/dbconfig-common/dpkg/config.mysql
        dbc_go mailman3-core "$@"
    fi
fi

db_input medium mailman3-core/config_hyperkitty || true
db_go
